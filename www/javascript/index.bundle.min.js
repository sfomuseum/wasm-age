window.addEventListener("load",function(){var n,s,o,j=document.getElementById("encrypt-wrapper"),w=document.getElementById("encrypt-toggle"),c=document.getElementById("encrypt"),F=document.getElementById("encrypt-key"),M=document.getElementById("encrypt-button"),S=document.getElementById("encrypt-result"),u=document.getElementById("encrypt-result-data"),O=document.getElementById("encrypt-result-qr"),i=document.getElementById("encrypt-feedback"),v=document.getElementById("encrypt-spinner-svg"),m=document.getElementById("encrypt-hide"),h=document.getElementById("encrypt-show"),f=document.getElementById("encrypt-copy"),p=document.getElementById("encrypt-qr"),k=document.getElementById("decrypt-wrapper"),l=document.getElementById("decrypt-toggle"),b=document.getElementById("decrypt"),E=document.getElementById("decrypt-key"),C=document.getElementById("decrypt-button"),x=document.getElementById("decrypt-result"),a=document.getElementById("decrypt-result-data"),r=document.getElementById("decrypt-feedback"),_=document.getElementById("decrypt-spinner-svg"),y=document.getElementById("decrypt-hide"),d=document.getElementById("decrypt-show"),g=document.getElementById("decrypt-copy"),A=document.getElementById("decrypt-qr");c.value="",F.value="",u.innerHTML="",b.value="",E.value="",a.innerHTML="",sfomuseum.golang.wasm.fetch("wasm/age.wasm").then(e=>{let D=!0,t="",T="",z="";p.onclick=function(){try{var e=new QRCode(O,{width:275,height:275});e.makeCode(T)}catch(e){console.log("Failed to generate QR code",e),i.innerText="Failed to generate QR code, "+e}},decrypt_qr_tick=function(){if(!n)return;if(n.readyState===n.HAVE_ENOUGH_DATA){s.height=n.videoHeight,s.width=n.videoWidth,o.drawImage(n,0,0,s.width,s.height);var i,t=o.getImageData(0,0,s.width,s.height),e=jsQR(t.data,t.width,t.height,{inversionAttempts:"dontInvert"});e&&(drawLine(e.location.topLeftCorner,e.location.topRightCorner,"#FF3B58"),drawLine(e.location.topRightCorner,e.location.bottomRightCorner,"#FF3B58"),drawLine(e.location.bottomRightCorner,e.location.bottomLeftCorner,"#FF3B58"),drawLine(e.location.bottomLeftCorner,e.location.topLeftCorner,"#FF3B58"),b.value=e.data,i=document.getElementById("decrypt-qr-video-feedback"),i&&(i.innerText="Found QR code, wrote data to input field"))}requestAnimationFrame(decrypt_qr_tick)},drawLine=function(e,t,n){o.beginPath(),o.moveTo(e.x,e.y),o.lineTo(t.x,t.y),o.lineWidth=8,o.strokeStyle=n,o.stroke()},decrypt_qr_dialog=function(e){n=document.createElement("video"),n.srcObject=e,n.setAttribute("playsinline",!0),n.play(),requestAnimationFrame(decrypt_qr_tick),s=document.createElement("canvas"),o=s.getContext("2d");var i,a,r,t=document.createElement("dialog");t.setAttribute("style","min-width:50vw;"),i=document.createElement("div"),i.setAttribute("id","decrypt-qr-video-close"),i.onclick=function(){return n.pause(),e.getTracks().forEach(e=>{e.readyState=="live"&&e.stop()}),t.close(),document.body.removeChild(t),!1},i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg>',t.appendChild(i),r=document.createElement("div"),r.setAttribute("class","feedback"),r.setAttribute("id","decrypt-qr-video-feedback"),t.appendChild(r),a=document.createElement("div"),a.setAttribute("id","decrypt-qr-video-grid"),a.appendChild(n),a.appendChild(s),t.appendChild(a),document.body.append(t),t.showModal()},A.onclick=function(){navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then(function(e){decrypt_qr_dialog(e)}).catch(e=>{console.error(e)})},m.onclick=function(){t=c.value,c.value="*".repeat(t.length),D=!0,m.style.display="none",h.style.display="inline-block"},h.onclick=function(){D=!1,c.value=t,t="",m.style.display="inline-block",h.style.display="none"},y.onclick=function(){y.style.display="none",d.style.display="inline-block",a.innerHTML="",a.appendChild(document.createTextNode("****"))},d.onclick=function(){y.style.display="inline-block",d.style.display="none",a.innerHTML="",a.appendChild(document.createTextNode(z))},c.oninput=function(e){const o=e.target,i=o.value,s=t.length,n=i.length;if(!n){t="";return}if(n==s)return;if(n<s)t=t.substr(0,n);else{const e=i.substr(s);t+=e}D&&(o.value="*".repeat(t.length))},w.onclick=function(){return w.setAttribute("disabled","disabled"),j.style.display="block",l.removeAttribute("disabled"),k.style.display="none",!1},l.onclick=function(){return l.setAttribute("disabled","disabled"),k.style.display="block",w.removeAttribute("disabled"),j.style.display="none",!1},M.onclick=function(){i.innerText="",T="";const e=F.value;if(!e)return i.innerText="Missing key to encrypt message with.",console.error("Missing key"),!1;const n=t;return n?(u.innerHTML="",O.innerHTML="",S.style.display="none",f.style.display="none",p.style.display="none",v.style.display="inline-block",setTimeout(function(){age_encrypt(e,n).then(e=>{T=e,v.style.display="none",u.innerHTML="",u.appendChild(document.createTextNode(T)),S.style.display="block",navigator.clipboard&&(f.style.display="inline-block"),p.style.display="inline-block"}).catch(e=>{v.style.display="none",i.innerText="Failed to encrypt text,"+e,console.error("Failed to encrypt body",e)})},100),!1):(i.innerText="Message (to encrypt) body is empty.",console.error("Missing body"),!1)},navigator.clipboard&&(f.onclick=function(){navigator.clipboard.writeText(T).then(e=>{i.innerText="Encrypted message copied to clipboard.",setTimeout(function(){i.innerText=""},3e3)}).catch(e=>{i.innerText="Failed to copy message to clipboard, "+e,console.error("sad",e)})}),C.onclick=function(){r.innerText="",z="";const e=E.value;if(!e)return r.innerText="Missing key to encrypt message with.",console.error("Missing key"),!1;const t=b.value;return a.innerHTML="",x.style.display="none",g.style.display="none",_.style.display="inline-block",setTimeout(function(){age_decrypt(e,t).then(e=>{_.style.display="none",z=e,a.innerHTML="",a.appendChild(document.createTextNode("****")),x.style.display="block",d.style.display="inline-block",navigator.clipboard&&(g.style.display="inline-block")}).catch(e=>{_.style.display="none",r.innerText="Failed to decrypt message, "+e,console.error("Failed to decrypt body",e)})},100),!1},navigator.clipboard&&(g.onclick=function(){navigator.clipboard.writeText(z).then(e=>{r.innerText="Decrypted message copied to clipboard.",setTimeout(function(){r.innerText=""},3e3)}).catch(e=>{r.innerText="Failed to copy message to clipboard, "+e,console.error("sad",e)})}),M.removeAttribute("disabled"),C.removeAttribute("disabled"),j.style.display="block",l.removeAttribute("disabled"),h.style.display="inline-block",A.style.display="inline-block"}).catch(e=>{alert("Failed to load age WebAssembly functions"),console.error("Failed to load WASMbinary",e)})})