window.addEventListener("load",function(){var s,o,i,O=document.getElementById("encrypt-wrapper"),b=document.getElementById("encrypt-toggle"),c=document.getElementById("encrypt"),D=document.getElementById("encrypt-key"),z=document.getElementById("encrypt-button"),A=document.getElementById("encrypt-result"),u=document.getElementById("encrypt-result-data"),x=document.getElementById("encrypt-result-qr"),n=document.getElementById("encrypt-feedback"),p=document.getElementById("encrypt-spinner-svg"),y=document.getElementById("encrypt-hide"),m=document.getElementById("encrypt-show"),j=document.getElementById("encrypt-copy"),C=document.getElementById("encrypt-load"),g=document.getElementById("encrypt-save"),v=document.getElementById("encrypt-qr"),N=document.getElementById("decrypt-wrapper"),l=document.getElementById("decrypt-toggle"),h=document.getElementById("decrypt"),S=document.getElementById("decrypt-key"),k=document.getElementById("decrypt-button"),E=document.getElementById("decrypt-result"),a=document.getElementById("decrypt-result-data"),r=document.getElementById("decrypt-feedback"),f=document.getElementById("decrypt-spinner-svg"),w=document.getElementById("decrypt-hide"),d=document.getElementById("decrypt-show"),_=document.getElementById("decrypt-copy"),M=document.getElementById("decrypt-load"),F=document.getElementById("decrypt-save"),T=document.getElementById("decrypt-qr");if(c.value="",D.value="",u.innerHTML="",h.value="",S.value="",a.innerHTML="",document.body.getAttribute("offline")){const e=location.pathname;console.debug("Register offline application",e),offline.application.init(e).then(e=>{console.debug("Offline application initialized.")}).catch(e=>{console.error("Failed to initialize offline application",e),alert("Failed to initialize offline application")})}sfomuseum.golang.wasm.fetch("wasm/age.wasm").then(e=>{let P=!0,t="",L="",R="";const B=function(){return new Promise((e)=>{var o,n=document.createElement("dialog");n.setAttribute("class","dialog");const l=function(){n.close(),document.body.removeChild(n)};o=document.createElement("div"),o.setAttribute("class","dialog-close"),o.onclick=function(){return l(),!1},o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg>',n.appendChild(o);const i=document.createElement("form");i.setAttribute("class","form");const s=document.createElement("input");s.setAttribute("class","form-control"),s.setAttribute("type","text"),s.setAttribute("id","filename");const a=document.createElement("label");a.setAttribute("class","form-label"),a.setAttribute("for","filename"),a.appendChild(document.createTextNode("Choose a new filename"));const r=document.createElement("button");r.setAttribute("class","btn btn-primary"),r.appendChild(document.createTextNode("Okay"));const c=document.createElement("div");c.setAttribute("class","mb-3"),c.appendChild(a),c.appendChild(s),i.appendChild(c),i.appendChild(r),r.onclick=function(){if(!s.value)return!1;e(s.value),l()},n.appendChild(i),document.body.append(n),n.showModal()})},H=function(e){return new Promise((t,n)=>{B().then(n=>{const i=new Blob([e],{type:"text/plain"}),o=URL.createObjectURL(i),s=document.createElement("a");s.href=o,s.download=n,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o),t()}).catch(e=>{n(e)})})},I=function(){return new Promise((e,t)=>{var o,n=document.createElement("dialog");n.setAttribute("class","dialog");const i=function(){n.close(),document.body.removeChild(n)};o=document.createElement("div"),o.setAttribute("class","dialog-close"),o.onclick=function(){return i(),!1},o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg>',n.appendChild(o);const a=document.createElement("form");a.setAttribute("class","form");const s=document.createElement("input");s.setAttribute("class","form-control"),s.setAttribute("type","file"),s.setAttribute("id","upload");const r=document.createElement("label");r.setAttribute("class","form-label"),r.setAttribute("for","upload"),r.appendChild(document.createTextNode("Upload file"));const c=document.createElement("button");c.setAttribute("class","btn btn-primary"),c.appendChild(document.createTextNode("Upload"));const l=document.createElement("div");l.setAttribute("class","mb-3"),l.appendChild(r),l.appendChild(s),a.appendChild(l),a.appendChild(c),c.onclick=function(){if(!s.files.length)return!1;try{const o=s.files[0],n=new FileReader;return n.onload=function(t){e(t.target.result),i()},n.onerror=function(){console.error("Failed to read file"),t("Unable to read file"),i()},n.readAsText(o),!1}catch(e){console.error("Failed to load file",e),t(e),i()}},n.appendChild(a),document.body.append(n),n.showModal()})},V=function(){I().then(e=>{h.value=e}).catch(e=>{r.innerText=e})};M.onclick=function(){V()},F.onclick=function(){return H(R).then(e=>{n.innerText="Save data to file"}).catch(e=>{n.innerText="Failed to save data to file, "+e}),!1};const $=function(){I().then(e=>{t=e,c.value="*".repeat(e.length)}).catch(e=>{n.innerText=e})};C.onclick=function(){$()},g.onclick=function(){return H(L).then(e=>{n.innerText="Save data to file"}).catch(e=>{n.innerText="Failed to save data to file, "+e}),!1},v.onclick=function(){try{var e=new QRCode(x,{width:275,height:275});e.makeCode(L)}catch(e){console.log("Failed to generate QR code",e),n.innerText="Failed to generate QR code, "+e}},decrypt_qr_tick=function(){if(!s)return;if(s.readyState===s.HAVE_ENOUGH_DATA){o.height=s.videoHeight,o.width=s.videoWidth,i.drawImage(s,0,0,o.width,o.height);var n,t=i.getImageData(0,0,o.width,o.height),e=jsQR(t.data,t.width,t.height,{inversionAttempts:"dontInvert"});e&&(drawLine(e.location.topLeftCorner,e.location.topRightCorner,"#FF3B58"),drawLine(e.location.topRightCorner,e.location.bottomRightCorner,"#FF3B58"),drawLine(e.location.bottomRightCorner,e.location.bottomLeftCorner,"#FF3B58"),drawLine(e.location.bottomLeftCorner,e.location.topLeftCorner,"#FF3B58"),h.value=e.data,n=document.getElementById("decrypt-qr-video-feedback"),n&&(n.innerText="Found QR code, wrote data to input field"))}requestAnimationFrame(decrypt_qr_tick)},drawLine=function(e,t,n){i.beginPath(),i.moveTo(e.x,e.y),i.lineTo(t.x,t.y),i.lineWidth=8,i.strokeStyle=n,i.stroke()},decrypt_qr_dialog=function(e){s=document.createElement("video"),s.srcObject=e,s.setAttribute("playsinline",!0),s.play(),requestAnimationFrame(decrypt_qr_tick),o=document.createElement("canvas"),i=o.getContext("2d");var n,a,r,t=document.createElement("dialog");t.setAttribute("style","min-width:50vw;"),n=document.createElement("div"),n.setAttribute("id","decrypt-qr-video-close"),n.onclick=function(){return s.pause(),e.getTracks().forEach(e=>{e.readyState=="live"&&e.stop()}),t.close(),document.body.removeChild(t),!1},n.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg>',t.appendChild(n),r=document.createElement("div"),r.setAttribute("class","feedback"),r.setAttribute("id","decrypt-qr-video-feedback"),t.appendChild(r),a=document.createElement("div"),a.setAttribute("id","decrypt-qr-video-grid"),a.appendChild(s),a.appendChild(o),t.appendChild(a),document.body.append(t),t.showModal()},T.onclick=function(){navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then(function(e){decrypt_qr_dialog(e)}).catch(e=>{console.error(e)})},y.onclick=function(){t=c.value,c.value="*".repeat(t.length),P=!0,y.style.display="none",m.style.display="inline-block"},m.onclick=function(){P=!1,c.value=t,t="",y.style.display="inline-block",m.style.display="none"},w.onclick=function(){w.style.display="none",d.style.display="inline-block",a.innerHTML="",a.appendChild(document.createTextNode("****"))},d.onclick=function(){w.style.display="inline-block",d.style.display="none",a.innerHTML="",a.appendChild(document.createTextNode(R))},c.oninput=function(e){const o=e.target,i=o.value,s=t.length,n=i.length;if(!n){t="";return}if(n==s)return;if(n<s)t=t.substr(0,n);else{const e=i.substr(s);t+=e}P&&(o.value="*".repeat(t.length))},b.onclick=function(){return b.setAttribute("disabled","disabled"),O.style.display="block",l.removeAttribute("disabled"),N.style.display="none",!1},l.onclick=function(){return l.setAttribute("disabled","disabled"),N.style.display="block",b.removeAttribute("disabled"),O.style.display="none",!1},z.onclick=function(){n.innerText="",L="";const e=D.value;if(!e)return n.innerText="Missing key to encrypt message with.",console.error("Missing key"),!1;const s=t;return s?(u.innerHTML="",x.innerHTML="",A.style.display="none",j.style.display="none",v.style.display="none",g.style.display="none",p.style.display="inline-block",setTimeout(function(){age_encrypt(e,s).then(e=>{L=e,p.style.display="none",u.innerHTML="",u.appendChild(document.createTextNode(L)),A.style.display="block",navigator.clipboard&&(j.style.display="inline-block"),v.style.display="inline-block",g.style.display="inline-block"}).catch(e=>{p.style.display="none",n.innerText="Failed to encrypt text,"+e,console.error("Failed to encrypt body",e)})},100),!1):(n.innerText="Message (to encrypt) body is empty.",console.error("Missing body"),!1)},navigator.clipboard&&(j.onclick=function(){navigator.clipboard.writeText(L).then(e=>{n.innerText="Encrypted message copied to clipboard.",setTimeout(function(){n.innerText=""},3e3)}).catch(e=>{n.innerText="Failed to copy message to clipboard, "+e,console.error("sad",e)})}),k.onclick=function(){r.innerText="",R="";const e=S.value;if(!e)return r.innerText="Missing key to encrypt message with.",console.error("Missing key"),!1;const t=h.value;return a.innerHTML="",E.style.display="none",_.style.display="none",f.style.display="inline-block",setTimeout(function(){age_decrypt(e,t).then(e=>{f.style.display="none",R=e,a.innerHTML="",a.appendChild(document.createTextNode("****")),E.style.display="block",d.style.display="inline-block",navigator.clipboard&&(_.style.display="inline-block"),F.style.display="inline-block"}).catch(e=>{f.style.display="none",r.innerText="Failed to decrypt message, "+e,console.error("Failed to decrypt body",e)})},100),!1},navigator.clipboard&&(_.onclick=function(){navigator.clipboard.writeText(R).then(e=>{r.innerText="Decrypted message copied to clipboard.",setTimeout(function(){r.innerText=""},3e3)}).catch(e=>{r.innerText="Failed to copy message to clipboard, "+e,console.error("sad",e)})}),z.removeAttribute("disabled"),k.removeAttribute("disabled"),O.style.display="block",l.removeAttribute("disabled"),m.style.display="inline-block",C.style.display="inline-block",T.style.display="inline-block",M.style.display="inline-block"}).catch(e=>{alert("Failed to load age WebAssembly functions"),console.error("Failed to load WASMbinary",e)})})