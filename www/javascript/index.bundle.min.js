window.addEventListener("load",function(){var n,s,o,b=document.getElementById("encrypt-wrapper"),v=document.getElementById("encrypt-toggle"),c=document.getElementById("encrypt"),T=document.getElementById("encrypt-key"),F=document.getElementById("encrypt-button"),x=document.getElementById("encrypt-result"),h=document.getElementById("encrypt-result-data"),A=document.getElementById("encrypt-result-qr"),i=document.getElementById("encrypt-feedback"),y=document.getElementById("encrypt-spinner-svg"),p=document.getElementById("encrypt-hide"),m=document.getElementById("encrypt-show"),j=document.getElementById("encrypt-copy"),O=document.getElementById("encrypt-save"),g=document.getElementById("encrypt-qr"),z=document.getElementById("decrypt-wrapper"),l=document.getElementById("decrypt-toggle"),d=document.getElementById("decrypt"),k=document.getElementById("decrypt-key"),E=document.getElementById("decrypt-button"),C=document.getElementById("decrypt-result"),a=document.getElementById("decrypt-result-data"),r=document.getElementById("decrypt-feedback"),w=document.getElementById("decrypt-spinner-svg"),_=document.getElementById("decrypt-hide"),u=document.getElementById("decrypt-show"),f=document.getElementById("decrypt-copy"),S=document.getElementById("decrypt-load"),M=document.getElementById("decrypt-qr");c.value="",T.value="",h.innerHTML="",d.value="",k.value="",a.innerHTML="",sfomuseum.golang.wasm.fetch("wasm/age.wasm").then(e=>{let L=!0,t="",D="",N="";const R=function(){return new Promise((e,t)=>{var o,n=document.createElement("dialog");n.setAttribute("style","min-width:50vw;");const i=function(){n.close(),document.body.removeChild(n)};o=document.createElement("div"),o.setAttribute("id","load-close"),o.onclick=function(){return i(),!1},o.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg>',n.appendChild(o);const a=document.createElement("form");a.setAttribute("class","form");const s=document.createElement("input");s.setAttribute("class","form-control"),s.setAttribute("type","file"),s.setAttribute("id","upload");const r=document.createElement("label");r.setAttribute("class","form-label"),r.setAttribute("for","upload"),r.appendChild(document.createTextNode("Upload file"));const c=document.createElement("button");c.setAttribute("class","btn btn-primary"),c.appendChild(document.createTextNode("Upload"));const l=document.createElement("div");l.setAttribute("class","mb-3"),l.appendChild(r),l.appendChild(s),a.appendChild(l),a.appendChild(c),c.onclick=function(){if(!s.files.length)return!1;try{const o=s.files[0],n=new FileReader;return n.onload=function(t){e(t.target.result),i()},n.onerror=function(){console.error("Failed to read file"),t("Unable to read file"),i()},n.readAsText(o),!1}catch(e){console.error("Failed to load file",e),t(e),i()}},n.appendChild(a),document.body.append(n),n.showModal()})},P=function(){R().then(e=>{d.value=e}).catch(e=>{feedback_el.innerText=e})};S.onclick=function(){const e=P()},O.onclick=function(){try{const n="age.txt",s=new Blob([D],{type:"text/plain"}),t=URL.createObjectURL(s),e=document.createElement("a");e.href=t,e.download=n,document.body.appendChild(e),e.click(),document.body.removeChild(e),URL.revokeObjectURL(t)}catch(e){console.error("Failed to save encrypted data",e),feedback_el.innerText="Failed to save encrypted data, "+e}},g.onclick=function(){try{var e=new QRCode(A,{width:275,height:275});e.makeCode(D)}catch(e){console.log("Failed to generate QR code",e),i.innerText="Failed to generate QR code, "+e}},decrypt_qr_tick=function(){if(!n)return;if(n.readyState===n.HAVE_ENOUGH_DATA){s.height=n.videoHeight,s.width=n.videoWidth,o.drawImage(n,0,0,s.width,s.height);var i,t=o.getImageData(0,0,s.width,s.height),e=jsQR(t.data,t.width,t.height,{inversionAttempts:"dontInvert"});e&&(drawLine(e.location.topLeftCorner,e.location.topRightCorner,"#FF3B58"),drawLine(e.location.topRightCorner,e.location.bottomRightCorner,"#FF3B58"),drawLine(e.location.bottomRightCorner,e.location.bottomLeftCorner,"#FF3B58"),drawLine(e.location.bottomLeftCorner,e.location.topLeftCorner,"#FF3B58"),d.value=e.data,i=document.getElementById("decrypt-qr-video-feedback"),i&&(i.innerText="Found QR code, wrote data to input field"))}requestAnimationFrame(decrypt_qr_tick)},drawLine=function(e,t,n){o.beginPath(),o.moveTo(e.x,e.y),o.lineTo(t.x,t.y),o.lineWidth=8,o.strokeStyle=n,o.stroke()},decrypt_qr_dialog=function(e){n=document.createElement("video"),n.srcObject=e,n.setAttribute("playsinline",!0),n.play(),requestAnimationFrame(decrypt_qr_tick),s=document.createElement("canvas"),o=s.getContext("2d");var i,a,r,t=document.createElement("dialog");t.setAttribute("style","min-width:50vw;"),i=document.createElement("div"),i.setAttribute("id","decrypt-qr-video-close"),i.onclick=function(){return n.pause(),e.getTracks().forEach(e=>{e.readyState=="live"&&e.stop()}),t.close(),document.body.removeChild(t),!1},i.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/></svg>',t.appendChild(i),r=document.createElement("div"),r.setAttribute("class","feedback"),r.setAttribute("id","decrypt-qr-video-feedback"),t.appendChild(r),a=document.createElement("div"),a.setAttribute("id","decrypt-qr-video-grid"),a.appendChild(n),a.appendChild(s),t.appendChild(a),document.body.append(t),t.showModal()},M.onclick=function(){navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then(function(e){decrypt_qr_dialog(e)}).catch(e=>{console.error(e)})},p.onclick=function(){t=c.value,c.value="*".repeat(t.length),L=!0,p.style.display="none",m.style.display="inline-block"},m.onclick=function(){L=!1,c.value=t,t="",p.style.display="inline-block",m.style.display="none"},_.onclick=function(){_.style.display="none",u.style.display="inline-block",a.innerHTML="",a.appendChild(document.createTextNode("****"))},u.onclick=function(){_.style.display="inline-block",u.style.display="none",a.innerHTML="",a.appendChild(document.createTextNode(N))},c.oninput=function(e){const o=e.target,i=o.value,s=t.length,n=i.length;if(!n){t="";return}if(n==s)return;if(n<s)t=t.substr(0,n);else{const e=i.substr(s);t+=e}L&&(o.value="*".repeat(t.length))},v.onclick=function(){return v.setAttribute("disabled","disabled"),b.style.display="block",l.removeAttribute("disabled"),z.style.display="none",!1},l.onclick=function(){return l.setAttribute("disabled","disabled"),z.style.display="block",v.removeAttribute("disabled"),b.style.display="none",!1},F.onclick=function(){i.innerText="",D="";const e=T.value;if(!e)return i.innerText="Missing key to encrypt message with.",console.error("Missing key"),!1;const n=t;return n?(h.innerHTML="",A.innerHTML="",x.style.display="none",j.style.display="none",g.style.display="none",O.style.display="none",y.style.display="inline-block",setTimeout(function(){age_encrypt(e,n).then(e=>{D=e,y.style.display="none",h.innerHTML="",h.appendChild(document.createTextNode(D)),x.style.display="block",navigator.clipboard&&(j.style.display="inline-block"),g.style.display="inline-block",O.style.display="inline-block"}).catch(e=>{y.style.display="none",i.innerText="Failed to encrypt text,"+e,console.error("Failed to encrypt body",e)})},100),!1):(i.innerText="Message (to encrypt) body is empty.",console.error("Missing body"),!1)},navigator.clipboard&&(j.onclick=function(){navigator.clipboard.writeText(D).then(e=>{i.innerText="Encrypted message copied to clipboard.",setTimeout(function(){i.innerText=""},3e3)}).catch(e=>{i.innerText="Failed to copy message to clipboard, "+e,console.error("sad",e)})}),E.onclick=function(){r.innerText="",N="";const e=k.value;if(!e)return r.innerText="Missing key to encrypt message with.",console.error("Missing key"),!1;const t=d.value;return a.innerHTML="",C.style.display="none",f.style.display="none",w.style.display="inline-block",setTimeout(function(){age_decrypt(e,t).then(e=>{w.style.display="none",N=e,a.innerHTML="",a.appendChild(document.createTextNode("****")),C.style.display="block",u.style.display="inline-block",navigator.clipboard&&(f.style.display="inline-block")}).catch(e=>{w.style.display="none",r.innerText="Failed to decrypt message, "+e,console.error("Failed to decrypt body",e)})},100),!1},navigator.clipboard&&(f.onclick=function(){navigator.clipboard.writeText(N).then(e=>{r.innerText="Decrypted message copied to clipboard.",setTimeout(function(){r.innerText=""},3e3)}).catch(e=>{r.innerText="Failed to copy message to clipboard, "+e,console.error("sad",e)})}),F.removeAttribute("disabled"),E.removeAttribute("disabled"),b.style.display="block",l.removeAttribute("disabled"),m.style.display="inline-block",M.style.display="inline-block",S.style.display="inline-block"}).catch(e=>{alert("Failed to load age WebAssembly functions"),console.error("Failed to load WASMbinary",e)})})